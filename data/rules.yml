version: "3.1"

rules:
### Default intent that starts the app ###
- rule: Init intent triggers greet and login form
  steps:
  - intent: init_intent
  - action: utter_greet
  - action: login_form
  - active_loop: login_form
### General rules ###
- rule: Say 'I am a bot' anytime the user challenges
  steps:
  - intent: bot_challenge_intent
  - action: action_restart
  - action: utter_iamabot

### Login and Logout rules ###
- rule: Open policies page
  steps:
  - intent: policies_info_intent
  - action: action_open_policies_page

- rule: Trigger action_logout on logout_intent
  steps:
  - intent: logout_intent
  - action: action_logout

### User Information rules ###
- rule: Show the user's CNP
  steps:
  - intent: show_my_user_info_intent
  - action: action_show_my_user_info

- rule: Show the user's CNP
  steps:
  - intent: show_my_cnp_intent
  - action: action_show_my_cnp

- rule: Show the user's name
  steps:
  - intent: show_my_name_intent
  - action: action_show_my_name

- rule: Show the user's surname
  steps:
  - intent: show_my_surname_intent
  - action: action_show_my_surname

- rule: Show the user's age
  steps:
  - intent: show_my_age_intent
  - action: action_show_my_age

- rule: Show the user's account number
  steps:
  - intent: show_my_account_number_intent
  - action: action_show_my_account_number

- rule: Show the user's registration date
  steps:
  - intent: show_my_registration_date_intent
  - action: action_show_registration_date

- rule: Show the user's current balance
  steps:
  - intent: show_my_balance_intent
  - action: action_show_my_balance

- rule: Show the user's current slots
  steps:
  - intent: show_slots_intent
  - action: action_show_slots

### Forms ###
# Login form
- rule: Check login status
  condition:
  - slot_was_set:
    - logged_in_status_slot: true
  steps:
  - intent: login_intent
  - action: utter_already_logged_in

- rule: Activate login form
  condition:
  - slot_was_set:
    - logged_in_status_slot: false
  steps:
  - intent: login_intent
  - action: login_form
  - active_loop: login_form

- rule: Submit login form
  condition:
  - active_loop: login_form
  steps:
  - action: login_form
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: submit_login_form

# Rule for asking CNP again
- rule: Ask for CNP again if not logged in
  condition:
  - slot_was_set:
    - logged_in_status_slot: false
  steps:
  - intent: check_cnp_again_intent
  - action: login_form
  - active_loop: login_form

- rule: Ask for CNP again if logged in
  condition:
  - slot_was_set:
    - logged_in_status_slot: true
  steps:
  - intent: check_cnp_again_intent
  - action: utter_already_logged_in

# New user form
- rule: Activate new user form
  steps:
  - intent: new_user_intent
  - action: new_user_form
  - active_loop: new_user_form

- rule: Submit new user form
  condition:
  - active_loop: new_user_form
  steps:
  - action: new_user_form
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  - action: submit_new_user_form
